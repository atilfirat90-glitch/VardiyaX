# Implementation Plan: ShiftCraft Clean Architecture

## Overview

Bu plan, ShiftCraft vardiya yönetim sisteminin .NET 8 ve Clean Architecture kullanılarak adım adım implementasyonunu tanımlar. Her task önceki task'lara bağlıdır ve incremental ilerleme sağlar.

## Tasks

- [x] 1. Solution ve proje yapısını oluştur
  - ShiftCraft.sln solution dosyası oluştur
  - ShiftCraft.Domain class library projesi oluştur (.NET 8)
  - ShiftCraft.Application class library projesi oluştur (.NET 8)
  - ShiftCraft.Infrastructure class library projesi oluştur (.NET 8)
  - ShiftCraft.Api web API projesi oluştur (.NET 8)
  - Proje referanslarını Clean Architecture kurallarına göre ayarla
  - _Requirements: Clean Architecture structure_

- [x] 2. Domain layer - Enums
  - [x] 2.1 Domain enum'larını oluştur
    - ScheduleStatus enum (Draft=0, Published=1, Archived=2)
    - ShiftSource enum (Manual=0, AutoGenerated=1, Swapped=2)
    - DayTypeCode enum (Weekday=0, Weekend=1, Holiday=2)
    - RuleCode enum (MaxDailyMinutes=0, WeeklyOffDays=1, CoreStaffMinimum=2)
    - _Requirements: 6.3, 8.2, 4.2, 12.4_

- [x] 3. Domain layer - Core Entities
  - [x] 3.1 Business entity oluştur
    - Id, Name, Timezone properties
    - Navigation properties for related entities
    - _Requirements: 1.1, 1.2_

  - [x] 3.2 Employee entity oluştur
    - Id, BusinessId, Name, IsCoreStaff, WeeklyMaxMinutes, IsActive
    - Business navigation property
    - _Requirements: 2.1, 2.2, 2.3, 2.4_

  - [x] 3.3 Role entity oluştur
    - Id, Name properties
    - _Requirements: 3.1_

  - [x] 3.4 EmployeeRole entity oluştur (composite key)
    - EmployeeId, RoleId (composite PK)
    - Navigation properties
    - _Requirements: 3.2_

  - [x] 3.5 DayType entity oluştur
    - Id, Code properties
    - _Requirements: 4.1_


- [x] 4. Domain layer - Schedule Entities
  - [x] 4.1 ShiftTemplate entity oluştur
    - Id, BusinessId, Name, StartTime, EndTime, DurationMinutes
    - Business navigation property
    - _Requirements: 5.1, 5.2_

  - [x] 4.2 WeeklySchedule entity oluştur
    - Id, BusinessId, WeekStartDate, Status
    - Business navigation property
    - _Requirements: 6.1, 6.2, 6.3_

  - [x] 4.3 ScheduleDay entity oluştur
    - Id, WeeklyScheduleId, Date, DayTypeId
    - Navigation properties
    - _Requirements: 7.1, 7.2_

  - [x] 4.4 ShiftAssignment entity oluştur
    - Id, ScheduleDayId, EmployeeId, RoleId, ShiftTemplateId, Source
    - Navigation properties
    - _Requirements: 8.1, 8.2_

- [x] 5. Domain layer - Rule Entities
  - [x] 5.1 ShiftRequirement entity oluştur
    - Id, BusinessId, DayTypeId, RoleId, ShiftTemplateId, RequiredCount
    - Navigation properties
    - _Requirements: 9.1, 9.2_

  - [x] 5.2 WorkRule entity oluştur
    - Id, BusinessId, IsSevenDaysOpen, MaxDailyMinutes, MinWeeklyOffDays
    - Business navigation property
    - _Requirements: 10.1, 10.2_

  - [x] 5.3 CoreStaffRule entity oluştur
    - Id, BusinessId, DayTypeId, MinCoreStaffCount
    - Navigation properties
    - _Requirements: 11.1, 11.2_

  - [x] 5.4 RuleViolation entity oluştur
    - Id, WeeklyScheduleId, EmployeeId, ViolationDate, RuleCode
    - Navigation properties
    - _Requirements: 12.1, 12.2, 12.3_

- [x] 6. Application layer - Repository Interfaces
  - [x] 6.1 IRepository<T> generic interface oluştur
    - GetByIdAsync, GetAllAsync, AddAsync, UpdateAsync, DeleteAsync
    - _Requirements: All CRUD operations_

  - [x] 6.2 Entity-specific repository interfaces oluştur
    - IBusinessRepository, IEmployeeRepository, IRoleRepository
    - IEmployeeRoleRepository, IDayTypeRepository, IShiftTemplateRepository
    - IWeeklyScheduleRepository, IScheduleDayRepository, IShiftAssignmentRepository
    - IShiftRequirementRepository, IWorkRuleRepository, ICoreStaffRuleRepository
    - IRuleViolationRepository
    - _Requirements: All entity operations_

- [x] 7. Application layer - Service Interfaces
  - [x] 7.1 IRuleEngineService interface oluştur
    - ValidateMaxDailyMinutes, ValidateWeeklyOffDays, ValidateCoreStaffMinimum
    - ValidateSchedule (all rules)
    - _Requirements: 13.1, 13.2, 13.3, 13.5_

  - [x] 7.2 IScheduleValidationService interface oluştur
    - ValidateOnPublish method
    - _Requirements: 13.5_

- [x] 8. Infrastructure layer - DbContext
  - [x] 8.1 ShiftCraftDbContext oluştur
    - DbSet for all 13 entities
    - OnModelCreating override for configurations
    - _Requirements: All entities_

- [x] 9. Infrastructure layer - Entity Configurations
  - [x] 9.1 Business, Employee, Role configurations
    - Primary keys, property configurations
    - FK relationships with NO ACTION delete behavior
    - _Requirements: 1.3, 2.5_

  - [x] 9.2 EmployeeRole configuration (composite key)
    - Composite primary key (EmployeeId, RoleId)
    - CASCADE delete for Employee, NO ACTION for Role
    - _Requirements: 3.3, 3.4_

  - [x] 9.3 DayType, ShiftTemplate configurations
    - Primary keys, property configurations
    - FK relationships with NO ACTION
    - _Requirements: 4.3, 5.4_

  - [x] 9.4 WeeklySchedule, ScheduleDay, ShiftAssignment configurations
    - CASCADE delete: WeeklySchedule→ScheduleDay→ShiftAssignment
    - NO ACTION for Employee, Role, ShiftTemplate references
    - _Requirements: 6.4, 7.3, 8.4_

  - [x] 9.5 ShiftRequirement, WorkRule, CoreStaffRule configurations
    - FK relationships with NO ACTION
    - _Requirements: 9.1, 10.1, 11.1_

  - [x] 9.6 RuleViolation configuration
    - CASCADE delete from WeeklySchedule
    - NO ACTION for Employee
    - _Requirements: 12.5, 2.5_

- [x] 10. Infrastructure layer - Repository Implementations
  - [x] 10.1 Generic Repository<T> implementation
    - EF Core based CRUD operations
    - Async methods
    - _Requirements: All CRUD_

  - [x] 10.2 Entity-specific repository implementations
    - Implement all 13 repository interfaces
    - Include navigation property loading where needed
    - _Requirements: All entities_

- [x] 11. Application layer - Rule Engine Service
  - [x] 11.1 RuleEngineService implementation
    - ValidateMaxDailyMinutes: Check total shift duration per employee per day
    - ValidateWeeklyOffDays: Check minimum off days per employee per week
    - ValidateCoreStaffMinimum: Check core staff count per day type
    - Create RuleViolation records for violations
    - _Requirements: 13.1, 13.2, 13.3, 13.4_

- [x] 12. API layer - Setup
  - [x] 12.1 Program.cs configuration
    - Dependency injection setup
    - DbContext registration
    - Repository registrations
    - Service registrations
    - Swagger configuration
    - Health check endpoint
    - _Requirements: DI, Swagger, Health check_

- [x] 13. API layer - Controllers
  - [x] 13.1 BusinessController
    - CRUD endpoints for Business entity
    - _Requirements: 1.1, 1.2, 1.3_

  - [x] 13.2 EmployeeController
    - CRUD endpoints for Employee entity
    - _Requirements: 2.1, 2.2, 2.5_

  - [x] 13.3 RoleController ve EmployeeRoleController
    - CRUD endpoints for Role and EmployeeRole
    - _Requirements: 3.1, 3.2, 3.3_

  - [x] 13.4 ShiftTemplateController
    - CRUD endpoints for ShiftTemplate
    - _Requirements: 5.1, 5.2_

  - [x] 13.5 WeeklyScheduleController
    - CRUD endpoints for WeeklySchedule
    - Publish endpoint with validation trigger
    - _Requirements: 6.1, 6.2, 6.3, 13.5_

  - [x] 13.6 ScheduleDayController ve ShiftAssignmentController
    - CRUD endpoints
    - _Requirements: 7.1, 8.1_

  - [x] 13.7 Rule Controllers
    - ShiftRequirementController, WorkRuleController, CoreStaffRuleController
    - RuleViolationController (read-only)
    - _Requirements: 9.1, 10.1, 11.1, 12.1_

- [x] 14. Checkpoint - Tüm testleri çalıştır
  - Tüm testlerin geçtiğinden emin ol
  - Kullanıcıya soru varsa sor

- [x] 15. Property Tests
  - [x] 15.1 Entity Association Validation property test
    - **Property 1: Entity Association Validation**
    - **Validates: Requirements 2.1, 5.1, 6.1, 7.1, 8.1, 9.1, 10.1, 11.1, 12.2**

  - [x] 15.2 Cascade Delete property test
    - **Property 2: Cascade Delete Consistency**
    - **Validates: Requirements 3.3, 6.4, 7.3, 12.5**

  - [x] 15.3 Referential Integrity property test
    - **Property 3: Referential Integrity Protection**
    - **Validates: Requirements 1.3, 2.5, 3.4, 4.3, 5.4, 8.4**

  - [x] 15.4 Rule Engine property tests
    - **Property 5: MaxDailyMinutes Rule Validation**
    - **Property 6: MinWeeklyOffDays Rule Validation**
    - **Property 7: CoreStaffMinimum Rule Validation**
    - **Validates: Requirements 10.3, 10.4, 11.2, 13.1, 13.2, 13.3**

- [x] 16. Final Checkpoint
  - Tüm testlerin geçtiğinden emin ol (14/14 PASSED)
  - API build başarılı
  - Swagger ve Health check endpoint'leri yapılandırıldı

## Notes

- Her task belirli requirements'lara referans verir
- Checkpoint'ler incremental doğrulama sağlar
- Property testler evrensel doğruluk özelliklerini validate eder
- Tüm testler zorunludur