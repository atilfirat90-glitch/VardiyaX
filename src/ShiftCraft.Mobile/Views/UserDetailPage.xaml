<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:ShiftCraft.Mobile.ViewModels"
             x:Class="ShiftCraft.Mobile.Views.UserDetailPage"
             x:DataType="vm:UserDetailViewModel"
             Title="{Binding Title}"
             BackgroundColor="{StaticResource Gray100}">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="15">
            <!-- Error Message -->
            <Frame IsVisible="{Binding ErrorMessage, Converter={StaticResource StringToBoolConverter}}"
                   BackgroundColor="#FFEBEE"
                   CornerRadius="8"
                   Padding="15">
                <Label Text="{Binding ErrorMessage}"
                       TextColor="#C62828"
                       FontSize="14"/>
            </Frame>

            <!-- Username -->
            <VerticalStackLayout Spacing="5">
                <Label Text="KullanÄ±cÄ± AdÄ±"
                       FontSize="14"
                       FontAttributes="Bold"
                       TextColor="{StaticResource Gray700}"/>
                <Entry Text="{Binding Username}"
                       Placeholder="KullanÄ±cÄ± adÄ± girin"
                       IsEnabled="{Binding IsEditMode, Converter={StaticResource InverseBoolConverter}}"
                       BackgroundColor="White"
                       FontSize="16"/>
            </VerticalStackLayout>

            <!-- Password (only for new users) -->
            <VerticalStackLayout Spacing="5" IsVisible="{Binding IsEditMode, Converter={StaticResource InverseBoolConverter}}">
                <Label Text="Åžifre"
                       FontSize="14"
                       FontAttributes="Bold"
                       TextColor="{StaticResource Gray700}"/>
                <Entry Text="{Binding Password}"
                       Placeholder="En az 8 karakter, 1 rakam"
                       IsPassword="True"
                       BackgroundColor="White"
                       FontSize="16"/>
                <Label Text="Åžifre en az 8 karakter ve 1 rakam iÃ§ermelidir"
                       FontSize="11"
                       TextColor="{StaticResource Gray500}"/>
            </VerticalStackLayout>

            <!-- Role -->
            <VerticalStackLayout Spacing="5">
                <Label Text="Rol"
                       FontSize="14"
                       FontAttributes="Bold"
                       TextColor="{StaticResource Gray700}"/>
                <Picker ItemsSource="{Binding Roles}"
                        SelectedItem="{Binding SelectedRole}"
                        BackgroundColor="White"
                        FontSize="16"/>
            </VerticalStackLayout>

            <!-- Active Status (only for edit) -->
            <Grid ColumnDefinitions="*,Auto" IsVisible="{Binding IsEditMode}">
                <Label Text="Aktif"
                       FontSize="14"
                       FontAttributes="Bold"
                       TextColor="{StaticResource Gray700}"
                       VerticalOptions="Center"/>
                <Switch Grid.Column="1"
                        IsToggled="{Binding IsActive}"
                        OnColor="{StaticResource Primary}"/>
            </Grid>

            <!-- Save Button -->
            <Button Text="{Binding IsEditMode, Converter={StaticResource EditModeToButtonTextConverter}}"
                    Command="{Binding SaveCommand}"
                    IsEnabled="{Binding IsBusy, Converter={StaticResource InverseBoolConverter}}"
                    BackgroundColor="{StaticResource Primary}"
                    TextColor="White"
                    FontSize="16"
                    HeightRequest="50"
                    CornerRadius="10"
                    Margin="0,10,0,0"/>

            <!-- Edit Mode Actions -->
            <VerticalStackLayout Spacing="10" IsVisible="{Binding IsEditMode}">
                <BoxView HeightRequest="1" Color="{StaticResource Gray200}" Margin="0,10"/>

                <!-- Reset Password -->
                <Button Text="ðŸ”‘ Åžifre SÄ±fÄ±rla"
                        Command="{Binding ResetPasswordCommand}"
                        IsEnabled="{Binding IsBusy, Converter={StaticResource InverseBoolConverter}}"
                        BackgroundColor="#FF9800"
                        TextColor="White"
                        FontSize="14"
                        HeightRequest="45"
                        CornerRadius="10"/>

                <!-- Temporary Password Display -->
                <Frame IsVisible="{Binding TemporaryPassword, Converter={StaticResource StringToBoolConverter}}"
                       BackgroundColor="#E3F2FD"
                       CornerRadius="8"
                       Padding="15">
                    <VerticalStackLayout Spacing="5">
                        <Label Text="GeÃ§ici Åžifre:"
                               FontSize="12"
                               TextColor="{StaticResource Gray600}"/>
                        <Label Text="{Binding TemporaryPassword}"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="{StaticResource Primary}"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- Deactivate -->
                <Button Text="ðŸš« KullanÄ±cÄ±yÄ± Devre DÄ±ÅŸÄ± BÄ±rak"
                        Command="{Binding DeactivateCommand}"
                        IsEnabled="{Binding IsBusy, Converter={StaticResource InverseBoolConverter}}"
                        BackgroundColor="#F44336"
                        TextColor="White"
                        FontSize="14"
                        HeightRequest="45"
                        CornerRadius="10"/>
            </VerticalStackLayout>

            <!-- Loading Indicator -->
            <ActivityIndicator IsRunning="{Binding IsBusy}"
                               IsVisible="{Binding IsBusy}"
                               Color="{StaticResource Primary}"
                               HeightRequest="40"/>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
